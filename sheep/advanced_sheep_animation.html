<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜çº§å°ç¾Šè¡Œèµ°åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: url('WechatIMG1675.jpg') center center / cover no-repeat;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            position: relative;
        }

        .scene {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* å¤ªé˜³ */
        .sun {
            position: absolute;
            top: 10%;
            right: 15%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            box-shadow: 0 0 30px #FFD700;
            animation: rotate 20s linear infinite;
        }

        .sun::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3), transparent);
            border-radius: 50%;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* äº‘æœµ */
        .clouds {
            position: absolute;
            top: 0;
            width: 100%;
            height: 40%;
        }

        .cloud {
            position: absolute;
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.85;
            animation: float 15s linear infinite;
            filter: drop-shadow(2px 2px 8px rgba(0,0,0,0.1));
        }

        /* ç§»é™¤ä¼ªå…ƒç´ æ ·å¼ */
        .cloud::before,
        .cloud::after {
            display: none;
        }

        .cloud1 {
            width: 240px;
            height: 160px;
            background-image: url('cloud1.png');
            top: 12%;
            left: -280px;
            animation-delay: 0s;
            animation-duration: 18s;
        }

        .cloud2 {
            width: 180px;
            height: 120px;
            background-image: url('cloud2.png');
            top: 28%;
            left: -220px;
            animation-delay: -6s;
            animation-duration: 22s;
        }

        .cloud3 {
            width: 220px;
            height: 140px;
            background-image: url('cloud3.png');
            top: 8%;
            left: -260px;
            animation-delay: -12s;
            animation-duration: 20s;
        }

        .cloud4 {
            width: 200px;
            height: 130px;
            background-image: url('cloud1.png');
            top: 35%;
            left: -240px;
            animation-delay: -3s;
            animation-duration: 25s;
        }

        .cloud5 {
            width: 160px;
            height: 100px;
            background-image: url('cloud2.png');
            top: 15%;
            left: -200px;
            animation-delay: -9s;
            animation-duration: 19s;
        }

        .cloud6 {
            width: 190px;
            height: 120px;
            background-image: url('cloud3.png');
            top: 22%;
            left: -230px;
            animation-delay: -15s;
            animation-duration: 23s;
        }

        @keyframes float {
            from { transform: translateX(0); }
            to { transform: translateX(calc(100vw + 150px)); }
        }

        /* å°ç¾ŠåŠ¨ç”» */
        .sheep-container {
            position: absolute;
            bottom: 0; /* æ”¹ä¸ºç›´æ¥åœ¨åº•éƒ¨ */
            left: 50px;
            transition: none;
        }

        .sheep {
            width: 64px; /* ç¼©å°åˆ°ä¸€åŠ */
            height: 64px; /* ç¼©å°åˆ°ä¸€åŠ */
            background-image: url('image.png');
            background-repeat: no-repeat;
            background-size: 512px 128px; /* æ¢å¤åŸå§‹å¤§å°ï¼Œ8å¸§x2æ’ */
            background-position: 0 0;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            cursor: grab;
            transition: transform 0.1s ease;
            user-select: none;
        }

        .sheep:active {
            cursor: grabbing;
        }

        .sheep.dragging {
            z-index: 1000;
            transform: scale(1.1);
        }

        /* æŠ“ç¾Šè®¡æ•°å™¨ */
        .catch-counter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            font-family: 'Arial', sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            border: 2px solid rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }

        .catch-counter:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }

        .catch-counter .emoji {
            font-size: 24px;
            margin-right: 8px;
        }

        .catch-counter .count {
            color: #4CAF50;
            font-size: 22px;
        }

        /* æŠ“ç¾ŠåŠ¨ç”»æ•ˆæœ */
        .catch-animation {
            animation: catchEffect 0.5s ease-out;
        }

        @keyframes catchEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); background: rgba(76, 175, 80, 0.2); }
            100% { transform: scale(1); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            /* å°ç¾Šåœ¨æ‰‹æœºä¸Šç¨å¾®å°ä¸€ç‚¹ */
            .sheep {
                width: 96px;
                height: 96px;
                background-size: 768px 192px;
            }
            
            /* è®¡æ•°å™¨åœ¨æ‰‹æœºä¸Šçš„é€‚é… */
            .catch-counter {
                top: 10px;
                right: 10px;
                padding: 12px 16px;
                font-size: 16px;
            }
            
            .catch-counter .emoji {
                font-size: 20px;
                margin-right: 6px;
            }
            
            .catch-counter .count {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="scene">
        <!-- å¤ªé˜³ -->
        <div class="sun"></div>
        
        <!-- äº‘æœµ -->
        <div class="clouds">
            <div class="cloud cloud1"></div>
            <div class="cloud cloud2"></div>
            <div class="cloud cloud3"></div>
            <div class="cloud cloud4"></div>
            <div class="cloud cloud5"></div>
            <div class="cloud cloud6"></div>
        </div>
        
        <!-- æŠ“ç¾Šè®¡æ•°å™¨ -->
        <div class="catch-counter" id="catchCounter">
            <span class="emoji">ğŸ‘</span>
            æŠ“åˆ°: <span class="count" id="catchCount">0</span> åª
        </div>
        
        <!-- å°ç¾Šç°åœ¨é€šè¿‡JavaScriptåŠ¨æ€åˆ›å»º -->
    </div>

    <script>
        // å¤šåªå°ç¾Šç®¡ç†
        let allSheep = [];
        let selectedSheep = null;
        let sheepCount = 7; // å›ºå®š6åªå°ç¾Š
        
        // æŠ“ç¾Šè®¡æ•°å™¨
        let catchCount = 0;
        
        // åŠ¨ç”»çŠ¶æ€
        let currentFrame = 0;
        let isWalking = false;
        let isDragging = false;
        let isAutoWalking = false;
        let isLarge = false;
        let direction = 1; // 1ä¸ºå³ï¼Œ-1ä¸ºå·¦
        let moveSpeed = 3.5; // é»˜è®¤é€Ÿåº¦æ”¹ä¸ºåŸæ¥çš„0.7å€
        let frameWidth = 64; // ç¼©å°åˆ°ä¸€åŠï¼Œä»128æ”¹ä¸º64
        let frameHeight = 64; // ç¼©å°åˆ°ä¸€åŠï¼Œä»128æ”¹ä¸º64
        
        // ä½ç½®å’Œç§»åŠ¨
        let currentX = 50;
        let currentY = 0; // æ”¹ä¸ºåº•éƒ¨
        let lastX = currentX;
        let totalDistance = 0;
        let frameDistance = 10; // æ¯ç§»åŠ¨10åƒç´ æ›´æ–°ä¸€å¸§ï¼ˆåŸæ¥æ˜¯20ï¼Œç°åœ¨æ›´å¿«ï¼‰
        
        // æ‹–æ‹½ç›¸å…³
        let dragOffset = { x: 0, y: 0 };
        let autoWalkInterval = null;

        // åˆå§‹åŒ–
        function init() {
            console.log('å¼€å§‹åˆå§‹åŒ–...');
            console.log('frameWidth:', frameWidth, 'frameHeight:', frameHeight);
            console.log('sheepCount:', sheepCount);
            
            createSheep();
            
            console.log('åˆ›å»ºå°ç¾Šåï¼ŒallSheep.length:', allSheep.length);
            console.log('allSheep:', allSheep);
            
            console.log('åˆå§‹åŒ–å®Œæˆï¼Œåˆ›å»ºäº†', allSheep.length, 'åªå°ç¾Š');
        }

        // æ›´æ–°å°ç¾Šä½ç½®
        function updateSheepPosition(sheepData = null) {
            if (sheepData) {
                sheepData.container.style.left = sheepData.currentX + 'px';
                sheepData.container.style.bottom = sheepData.currentY + 'px';
            } else if (selectedSheep) {
                selectedSheep.container.style.left = selectedSheep.currentX + 'px';
                selectedSheep.container.style.bottom = selectedSheep.currentY + 'px';
            }
        }

        // æ›´æ–°åŠ¨ç”»å¸§
        function updateFrame() {
            const row = isDragging ? 1 : 0; // 0ä¸ºèµ°è·¯ï¼Œ1ä¸ºæ‹–æ‹½
            const frameX = -(currentFrame * frameWidth);
            const frameY = -(row * frameHeight);
            
            // æ›´æ–°é€‰ä¸­çš„å°ç¾Š
            if (selectedSheep) {
                selectedSheep.element.style.backgroundPosition = `${frameX}px ${frameY}px`;
                selectedSheep.element.style.transform = direction === 1 ? 'scaleX(-1)' : 'scaleX(1)';
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            // ç®€åŒ–çŠ¶æ€æ›´æ–°ï¼Œåªåœ¨æ§åˆ¶å°è¾“å‡ºè°ƒè¯•ä¿¡æ¯
            if (selectedSheep) {
                console.log(`å°ç¾ŠçŠ¶æ€ - ID: ${selectedSheep.id}, å¸§: ${selectedSheep.currentFrame}, é€Ÿåº¦: ${selectedSheep.walkSpeed.toFixed(1)}`);
            }
        }

        // ç§»åŠ¨å°ç¾Šå¹¶æ›´æ–°åŠ¨ç”»
        function moveSheep(deltaX, deltaY = 0) {
            const newX = Math.max(0, Math.min(window.innerWidth - frameWidth, currentX + deltaX));
            const newY = Math.max(0, Math.min(window.innerHeight - frameHeight, currentY + deltaY));
            
            // è®¡ç®—å®é™…ç§»åŠ¨è·ç¦»
            const actualDeltaX = newX - currentX;
            const actualDeltaY = newY - currentY;
            const distance = Math.sqrt(actualDeltaX * actualDeltaX + actualDeltaY * actualDeltaY);
            
            if (distance > 0) {
                currentX = newX;
                currentY = newY;
                totalDistance += distance;
                
                // æ ¹æ®ç§»åŠ¨æ–¹å‘æ›´æ–°æœå‘ - ä¿®å¤æ–¹å‘é€»è¾‘
                if (actualDeltaX > 0) {
                    direction = 1; // å‘å³ç§»åŠ¨ï¼Œä¸ç¿»è½¬
                } else if (actualDeltaX < 0) {
                    direction = -1; // å‘å·¦ç§»åŠ¨ï¼Œç¿»è½¬
                }
                
                // æ ¹æ®ç§»åŠ¨è·ç¦»æ›´æ–°å¸§ - æ›´é¢‘ç¹çš„å¸§æ›´æ–°
                const frameStep = Math.floor(totalDistance / frameDistance);
                currentFrame = frameStep % 8;
                
                isWalking = true;
                updateSheepPosition();
                updateFrame();
                updateStatus();
                
                // åœæ­¢ç§»åŠ¨åé‡ç½®çŠ¶æ€
                clearTimeout(window.walkTimeout);
                window.walkTimeout = setTimeout(() => {
                    if (!isDragging && !isAutoWalking) {
                        isWalking = false;
                        updateStatus();
                    }
                }, 100);
            }
        }

        // è‡ªåŠ¨è¡Œèµ°
        function startAutoWalk() {
            if (autoWalkInterval) return;
            
            isAutoWalking = true;
            autoWalkInterval = setInterval(() => {
                const step = moveSpeed * direction;
                
                // æ£€æŸ¥è¾¹ç•Œå¹¶ä»å¦ä¸€è¾¹å‡ºç°
                if (direction > 0) { // å‘å³ç§»åŠ¨
                    currentX += step;
                    if (currentX > window.innerWidth) {
                        // ä»å·¦è¾¹å‡ºç°
                        currentX = -frameWidth;
                    }
                } else { // å‘å·¦ç§»åŠ¨
                    currentX += step;
                    if (currentX < -frameWidth) {
                        // ä»å³è¾¹å‡ºç°
                        currentX = window.innerWidth;
                    }
                }
                
                // æ›´æ–°ä½ç½®å’ŒåŠ¨ç”»
                totalDistance += Math.abs(step);
                const frameStep = Math.floor(totalDistance / frameDistance);
                currentFrame = frameStep % 8;
                isWalking = true;
                
                updateSheepPosition();
                updateFrame();
                updateStatus();
            }, 30);
            
            updateStatus();
        }

        function stopAutoWalk() {
            if (autoWalkInterval) {
                clearInterval(autoWalkInterval);
                autoWalkInterval = null;
            }
            isAutoWalking = false;
            updateStatus();
        }

        function toggleAutoWalk() {
            if (isAutoWalking) {
                stopAutoWalk();
            } else {
                startAutoWalk();
            }
        }

        // æ‹–æ‹½åŠŸèƒ½
        function startDragging(e) {
            if (!selectedSheep) return;
            
            isDragging = true;
            selectedSheep.element.classList.add('dragging');
            selectedSheep.element.style.cursor = 'grabbing';
            stopAutoWalk();
            
            const rect = selectedSheep.element.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            updateStatus();
        }

        function stopDraggingSheep() {
            if (selectedSheep && selectedSheep.isDragging) {
                console.log('åœæ­¢æ‹–æ‹½å°ç¾Š:', selectedSheep.id);
                selectedSheep.isDragging = false;
                selectedSheep.element.classList.remove('dragging');
                selectedSheep.element.style.cursor = 'grab';
                
                // è®©å°ç¾Šè½å›åœ°é¢
                dropSheepToGround(selectedSheep);
                
                updateMainSheepData();
                updateStatus();
            }
        }

        // è®©å°ç¾Šè½å›åœ°é¢å¹¶ç»§ç»­è·‘åŠ¨
        function dropSheepToGround(sheepData) {
            const groundY = 0; // åœ°é¢é«˜åº¦æ”¹ä¸º0
            const currentY = sheepData.currentY;
            
            // å¦‚æœå°ç¾Šåœ¨ç©ºä¸­ï¼Œè®©å®ƒè½ä¸‹
            if (currentY > groundY + 20) { // å¦‚æœè·ç¦»åœ°é¢è¶…è¿‡20åƒç´ 
                let velocity = 0; // åˆå§‹é€Ÿåº¦
                const gravity = 0.8; // é‡åŠ›åŠ é€Ÿåº¦
                const bounce = 0.6; // å¼¹è·³ç³»æ•°
                let bounceCount = 0; // å¼¹è·³æ¬¡æ•°
                
                // æ·»åŠ è½ä¸‹åŠ¨ç”»
                const fallAnimation = () => {
                    velocity += gravity; // åŠ é€Ÿä¸‹è½
                    sheepData.currentY -= velocity;
                    
                    // æ£€æŸ¥æ˜¯å¦è§¦åœ°
                    if (sheepData.currentY <= groundY) {
                        sheepData.currentY = groundY;
                        
                        // å¦‚æœè¿˜æœ‰å¼¹è·³èƒ½é‡ä¸”å¼¹è·³æ¬¡æ•°å°‘äº3æ¬¡
                        if (Math.abs(velocity) > 2 && bounceCount < 3) {
                            velocity = -velocity * bounce; // åå‘å¼¹è·³
                            bounceCount++;
                        } else {
                            // åœæ­¢å¼¹è·³ï¼Œå¼€å§‹è·‘åŠ¨
                            velocity = 0;
                            sheepData.currentY = groundY;
                            sheepData.container.style.bottom = groundY + 'px';
                            
                            // åˆ‡æ¢å›è¡Œèµ°åŠ¨ç”»å¹¶å¼€å§‹è‡ªåŠ¨è·‘åŠ¨
                            updateSheepFrame(sheepData);
                            startAutoWalkSheep(sheepData);
                            return; // ç»“æŸåŠ¨ç”»
                        }
                    }
                    
                    // æ›´æ–°ä½ç½®
                    sheepData.container.style.bottom = sheepData.currentY + 'px';
                    
                    // ç»§ç»­åŠ¨ç”»
                    requestAnimationFrame(fallAnimation);
                };
                
                // å¼€å§‹è½ä¸‹åŠ¨ç”»
                requestAnimationFrame(fallAnimation);
            } else {
                // å¦‚æœå·²ç»åœ¨åœ°é¢é™„è¿‘ï¼Œç›´æ¥å¼€å§‹è·‘åŠ¨
                sheepData.currentY = groundY;
                sheepData.container.style.bottom = groundY + 'px';
                updateSheepFrame(sheepData);
                startAutoWalkSheep(sheepData);
            }
        }

        function dragSheep(e) {
            if (!selectedSheep || !selectedSheep.isDragging) return;
            
            e.preventDefault();
            
            // è®¡ç®—æ–°ä½ç½®
            const newX = e.clientX - dragOffset.x;
            const newY = e.clientY - dragOffset.y;
            
            // è½¬æ¢ä¸ºåº•éƒ¨åæ ‡ç³»
            const bottomY = window.innerHeight - newY - frameHeight;
            
            // ç›´æ¥æ›´æ–°ä½ç½®
            selectedSheep.container.style.left = newX + 'px';
            selectedSheep.container.style.bottom = bottomY + 'px';
            
            // æ›´æ–°å†…éƒ¨åæ ‡
            selectedSheep.currentX = newX;
            selectedSheep.currentY = bottomY;
            
            // æ›´æ–°åŠ¨ç”»å¸§
            selectedSheep.totalDistance += 5;
            selectedSheep.currentFrame = Math.floor(selectedSheep.totalDistance / frameDistance) % 8;
            updateSheepFrame(selectedSheep);
            
            updateMainSheepData();
            updateStatus();
        }

        // æ§åˆ¶å‡½æ•°
        function resetPosition() {
            stopAutoWalk();
            currentX = 50;
            currentY = 0;
            currentFrame = 0;
            totalDistance = 0;
            direction = 1;
            isWalking = false;
            
            updateSheepPosition();
            updateFrame();
            updateStatus();
        }

        function toggleDirection() {
            direction *= -1;
            updateFrame();
        }

        function toggleSize() {
            isLarge = !isLarge;
            if (isLarge) {
                frameWidth = 96; // å¤§å°ºå¯¸æ—¶ä¸º96px
                frameHeight = 96;
                if (selectedSheep) {
                    selectedSheep.element.style.width = '96px';
                    selectedSheep.element.style.height = '96px';
                    selectedSheep.element.style.backgroundSize = '768px 192px';
                }
            } else {
                frameWidth = 64; // æ­£å¸¸å°ºå¯¸ä¸º64px
                frameHeight = 64;
                if (selectedSheep) {
                    selectedSheep.element.style.width = '64px';
                    selectedSheep.element.style.height = '64px';
                    selectedSheep.element.style.backgroundSize = '512px 128px';
                }
            }
            if (selectedSheep) {
                updateFrame();
            }
        }

        function showFrameInfo() {
            if (selectedSheep) {
                alert(`å½“å‰å°ç¾Šä¿¡æ¯ï¼š
ID: ${selectedSheep.id}
å¸§æ•°: ${selectedSheep.currentFrame}/7
çŠ¶æ€: ${selectedSheep.isDragging ? 'æ‹–æ‹½' : (selectedSheep.isAutoWalking ? 'è‡ªåŠ¨è¡Œèµ°' : 'å¾…æœº')}
ä½ç½®: (${Math.round(selectedSheep.currentX)}, ${Math.round(selectedSheep.currentY)})
æ–¹å‘: ${selectedSheep.direction > 0 ? 'å³â†’' : 'å·¦â†'} (${selectedSheep.direction})
è¡Œèµ°é€Ÿåº¦: ${selectedSheep.walkSpeed.toFixed(1)}
æ€»ç§»åŠ¨è·ç¦»: ${Math.round(selectedSheep.totalDistance)}px
å¸§è·ç¦»: ${frameDistance}px/å¸§`);
            } else {
                alert('è¯·å…ˆç‚¹å‡»é€‰æ‹©ä¸€åªå°ç¾Šï¼');
            }
        }

        // è‡ªåŠ¨æ£€æµ‹ç²¾çµå›¾
        function detectSpriteSheet() {
            const img = new Image();
            img.onload = function() {
                const detectedFrameWidth = this.width / 8;
                const detectedFrameHeight = this.height / 2;
                
                if (!isLarge) {
                    frameWidth = detectedFrameWidth; // æ¢å¤åŸå§‹å¤§å°æ£€æµ‹
                    frameHeight = detectedFrameHeight; // æ¢å¤åŸå§‹å¤§å°æ£€æµ‹
                    
                    // æ›´æ–°æ‰€æœ‰å°ç¾Šçš„å¤§å°
                    allSheep.forEach(sheepData => {
                        sheepData.element.style.width = frameWidth + 'px';
                        sheepData.element.style.height = frameHeight + 'px';
                        sheepData.element.style.backgroundSize = `${this.width}px ${this.height}px`;
                    });
                }
                
                console.log(`æ£€æµ‹åˆ°ç²¾çµå›¾: ${this.width}x${this.height}, æ¯å¸§: ${frameWidth}x${frameHeight}`);
                updateFrame();
            };
            img.src = 'image.png';
        }

        // åŠ¨æ€è°ƒæ•´å°ç¾Šå¤§å°
        function adjustSheepSizeForDevice() {
            const screenWidth = window.innerWidth;
            let scaleFactor = 1;
            
            if (screenWidth <= 480) {
                scaleFactor = 0.6; // è¶…å°å±å¹•
                frameWidth = 64 * scaleFactor;
                frameHeight = 64 * scaleFactor;
            } else if (screenWidth <= 768) {
                scaleFactor = 0.75; // å¹³æ¿å’Œæ‰‹æœº
                frameWidth = 64 * scaleFactor;
                frameHeight = 64 * scaleFactor;
            } else {
                scaleFactor = 1; // æ¡Œé¢
                frameWidth = 64;
                frameHeight = 64;
            }
            
            // æ›´æ–°æ‰€æœ‰å°ç¾Šçš„å¤§å°
            allSheep.forEach(sheepData => {
                sheepData.element.style.width = frameWidth + 'px';
                sheepData.element.style.height = frameHeight + 'px';
                sheepData.element.style.backgroundSize = `${512 * scaleFactor}px ${128 * scaleFactor}px`;
            });
            
            console.log(`å±å¹•å®½åº¦: ${screenWidth}px, ç¼©æ”¾å› å­: ${scaleFactor}, å°ç¾Šå¤§å°: ${frameWidth}x${frameHeight}`);
        }

        // æ›´æ–°æŠ“ç¾Šè®¡æ•°å™¨
        function updateCatchCounter() {
            const counterElement = document.getElementById('catchCount');
            const containerElement = document.getElementById('catchCounter');
            
            if (counterElement) {
                counterElement.textContent = catchCount;
            }
            
            // æ·»åŠ æŠ“ç¾ŠåŠ¨ç”»æ•ˆæœ
            if (containerElement) {
                containerElement.classList.add('catch-animation');
                setTimeout(() => {
                    containerElement.classList.remove('catch-animation');
                }, 500);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            detectSpriteSheet();
            adjustSheepSizeForDevice(); // è°ƒæ•´å°ç¾Šå¤§å°
            init();
        });

        // å…¨å±€æ‹–æ‹½äº‹ä»¶ç›‘å¬
        document.addEventListener('mousemove', function(e) {
            if (selectedSheep && selectedSheep.isDragging) {
                e.preventDefault();
                
                // è®¡ç®—æ–°ä½ç½®
                const newX = e.clientX - dragOffset.x;
                const newY = e.clientY - dragOffset.y;
                
                // è½¬æ¢ä¸ºåº•éƒ¨åæ ‡ç³»
                const bottomY = window.innerHeight - newY - frameHeight;
                
                // ç›´æ¥æ›´æ–°ä½ç½®
                selectedSheep.container.style.left = newX + 'px';
                selectedSheep.container.style.bottom = bottomY + 'px';
                
                // æ›´æ–°å†…éƒ¨åæ ‡
                selectedSheep.currentX = newX;
                selectedSheep.currentY = bottomY;
                
                // æ›´æ–°åŠ¨ç”»å¸§
                selectedSheep.totalDistance += 5;
                selectedSheep.currentFrame = Math.floor(selectedSheep.totalDistance / frameDistance) % 8;
                updateSheepFrame(selectedSheep);
                
                updateMainSheepData();
            }
        });

        document.addEventListener('mouseup', function() {
            if (selectedSheep && selectedSheep.isDragging) {
                console.log('åœæ­¢æ‹–æ‹½å°ç¾Š:', selectedSheep.id);
                selectedSheep.isDragging = false;
                selectedSheep.element.classList.remove('dragging');
                selectedSheep.element.style.cursor = 'grab';
                
                // è®©å°ç¾Šè½å›åœ°é¢
                dropSheepToGround(selectedSheep);
                
                updateMainSheepData();
            }
        });

        // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´ä½ç½®å’Œå¤§å°
        window.addEventListener('resize', function() {
            adjustSheepSizeForDevice(); // é‡æ–°è°ƒæ•´å°ç¾Šå¤§å°
            
            // è°ƒæ•´å°ç¾Šä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè¾¹ç•Œ
            allSheep.forEach(sheepData => {
                sheepData.currentX = Math.min(sheepData.currentX, window.innerWidth - frameWidth);
                sheepData.currentY = Math.max(0, Math.min(sheepData.currentY, window.innerHeight - frameHeight));
                updateSheepPosition(sheepData);
            });
            
            if (selectedSheep) {
                currentX = Math.min(currentX, window.innerWidth - frameWidth);
                currentY = Math.max(0, Math.min(currentY, window.innerHeight - frameHeight));
                updateSheepPosition();
            }
        });

        // åˆ›å»ºå¤šåªå°ç¾Š
        function createSheep() {
            console.log('createSheep å‡½æ•°å¼€å§‹æ‰§è¡Œ...');
            
            // æ¸…é™¤ç°æœ‰å°ç¾Š
            allSheep.forEach(sheepData => {
                if (sheepData.container) {
                    sheepData.container.remove();
                }
            });
            allSheep = [];
            
            console.log('å‡†å¤‡åˆ›å»º', sheepCount, 'åªå°ç¾Š');
            
            // åˆ›å»ºæ–°çš„å°ç¾Š
            for (let i = 0; i < sheepCount; i++) {
                console.log('åˆ›å»ºç¬¬', i + 1, 'åªå°ç¾Š...');
                
                const container = document.createElement('div');
                container.className = 'sheep-container';
                container.style.position = 'absolute';
                container.style.bottom = '0'; // æ”¹ä¸ºåº•éƒ¨
                
                // éšæœºä½ç½®
                const randomX = Math.random() * (window.innerWidth - frameWidth);
                container.style.left = randomX + 'px';
                container.style.transition = 'none';
                
                const sheepElement = document.createElement('div');
                sheepElement.className = 'sheep';
                sheepElement.style.width = frameWidth + 'px';
                sheepElement.style.height = frameHeight + 'px';
                sheepElement.style.backgroundImage = "url('image.png')";
                sheepElement.style.backgroundRepeat = 'no-repeat';
                sheepElement.style.backgroundSize = `${8 * frameWidth}px ${2 * frameHeight}px`; // åŠ¨æ€è®¡ç®— backgroundSize
                sheepElement.style.backgroundPosition = '0 0';
                sheepElement.style.filter = 'drop-shadow(2px 2px 4px rgba(0,0,0,0.3))';
                sheepElement.style.cursor = 'grab';
                sheepElement.style.transition = 'transform 0.1s ease';
                sheepElement.style.userSelect = 'none';
                
                container.appendChild(sheepElement);
                
                const scene = document.querySelector('.scene');
                if (scene) {
                    scene.appendChild(container);
                    console.log('å°ç¾Š', i + 1, 'å·²æ·»åŠ åˆ°åœºæ™¯');
                } else {
                    console.error('æ‰¾ä¸åˆ° .scene å…ƒç´ ï¼');
                }
                
                // åˆ›å»ºå°ç¾Šæ•°æ®
                const sheepData = {
                    id: i,
                    container: container,
                    element: sheepElement,
                    currentX: randomX,
                    currentY: 0,
                    currentFrame: 0,
                    direction: 1, // æ‰€æœ‰å°ç¾Šéƒ½å‘å³èµ°
                    totalDistance: 0,
                    isWalking: false,
                    isDragging: false,
                    isAutoWalking: false,
                    autoWalkInterval: null,
                    color: `hue-rotate(${i * 60}deg)`, // ä¸åŒé¢œè‰²
                    walkSpeed: 4.5 + Math.random() * 4 // éšæœºé€Ÿåº¦ 4.5-8.5ï¼Œæœ€æ…¢4.5
                };
                
                // åº”ç”¨é¢œè‰²æ»¤é•œ
                sheepElement.style.filter += ` ${sheepData.color}`;
                
                // é‡è¦ï¼šç«‹å³è®¾ç½®æ­£ç¡®çš„åŠ¨ç”»å¸§æ˜¾ç¤º
                updateSheepFrame(sheepData);
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬
                sheepElement.addEventListener('mousedown', (e) => {
                    console.log('ç‚¹å‡»å°ç¾Š:', i);
                    startDraggingSheep(e, sheepData);
                });
                
                sheepElement.addEventListener('touchstart', (e) => {
                    console.log('è§¦æ‘¸å°ç¾Š:', i);
                    e.preventDefault();
                    const touch = e.touches[0];
                    startDraggingSheep({
                        preventDefault: () => {},
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    }, sheepData);
                });
                
                allSheep.push(sheepData);
                console.log('å°ç¾Š', i + 1, 'æ•°æ®å·²æ·»åŠ åˆ°æ•°ç»„ï¼Œå½“å‰æ•°ç»„é•¿åº¦:', allSheep.length);
                
                // è‡ªåŠ¨å¼€å§‹è¡Œèµ°
                startAutoWalkSheep(sheepData);
                console.log('å°ç¾Š', i + 1, 'å¼€å§‹è‡ªåŠ¨è¡Œèµ°');
            }
            
            // è®¾ç½®ç¬¬ä¸€åªä¸ºé€‰ä¸­çŠ¶æ€
            if (allSheep.length > 0) {
                selectedSheep = allSheep[0];
                updateMainSheepData();
                console.log('è®¾ç½®ç¬¬ä¸€åªå°ç¾Šä¸ºé€‰ä¸­çŠ¶æ€');
            }
            
            console.log('createSheep å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œæ€»å…±åˆ›å»ºäº†', allSheep.length, 'åªå°ç¾Š');
        }

        // æ›´æ–°ä¸»è¦å°ç¾Šæ•°æ®ï¼ˆç”¨äºUIæ˜¾ç¤ºï¼‰
        function updateMainSheepData() {
            if (selectedSheep) {
                currentX = selectedSheep.currentX;
                currentY = selectedSheep.currentY;
                currentFrame = selectedSheep.currentFrame;
                direction = selectedSheep.direction;
                totalDistance = selectedSheep.totalDistance;
                isDragging = selectedSheep.isDragging;
                isWalking = selectedSheep.isWalking;
                isAutoWalking = selectedSheep.isAutoWalking;
            }
        }

        // ç§»åŠ¨æŒ‡å®šå°ç¾Š
        function moveSheepData(sheepData, deltaX, deltaY = 0) {
            const newX = Math.max(0, Math.min(window.innerWidth - frameWidth, sheepData.currentX + deltaX));
            const newY = Math.max(0, Math.min(window.innerHeight - frameHeight, sheepData.currentY + deltaY));
            
            const actualDeltaX = newX - sheepData.currentX;
            const actualDeltaY = newY - sheepData.currentY;
            const distance = Math.sqrt(actualDeltaX * actualDeltaX + actualDeltaY * actualDeltaY);
            
            if (distance > 0) {
                sheepData.currentX = newX;
                sheepData.currentY = newY;
                sheepData.totalDistance += distance;
                
                // æ ¹æ®ç§»åŠ¨æ–¹å‘æ›´æ–°æœå‘ - ä½¿ç”¨åè½¬çš„æ–¹å‘é€»è¾‘
                if (actualDeltaX > 0) {
                    sheepData.direction = 1; // å‘å³ç§»åŠ¨
                } else if (actualDeltaX < 0) {
                    sheepData.direction = -1; // å‘å·¦ç§»åŠ¨
                }
                
                // æ ¹æ®ç§»åŠ¨è·ç¦»æ›´æ–°å¸§
                const frameStep = Math.floor(sheepData.totalDistance / frameDistance);
                sheepData.currentFrame = frameStep % 8;
                
                sheepData.isWalking = true;
                updateSheepPosition(sheepData);
                updateSheepFrame(sheepData);
                
                // å¦‚æœæ˜¯é€‰ä¸­çš„å°ç¾Šï¼Œæ›´æ–°UI
                if (selectedSheep === sheepData) {
                    updateMainSheepData();
                    updateStatus();
                }
                
                // åœæ­¢ç§»åŠ¨åé‡ç½®çŠ¶æ€
                clearTimeout(sheepData.walkTimeout);
                sheepData.walkTimeout = setTimeout(() => {
                    if (!sheepData.isDragging && !sheepData.isAutoWalking) {
                        sheepData.isWalking = false;
                        if (selectedSheep === sheepData) {
                            updateMainSheepData();
                            updateStatus();
                        }
                    }
                }, 100);
            }
        }

        // æ›´æ–°å°ç¾ŠåŠ¨ç”»å¸§
        function updateSheepFrame(sheepData) {
            const row = sheepData.isDragging ? 1 : 0;
            const frameX = -(sheepData.currentFrame * frameWidth);
            const frameY = -(row * frameHeight);
            
            sheepData.element.style.backgroundPosition = `${frameX}px ${frameY}px`;
            sheepData.element.style.transform = sheepData.direction === 1 ? 'scaleX(-1)' : 'scaleX(1)';
        }

        // æ‹–æ‹½æŒ‡å®šå°ç¾Š
        function startDraggingSheep(e, sheepData) {
            e.preventDefault();
            selectedSheep = sheepData;
            sheepData.isDragging = true;
            sheepData.element.classList.add('dragging');
            sheepData.element.style.cursor = 'grabbing';
            stopAutoWalkSheep(sheepData);
            
            const rect = sheepData.element.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            // ç«‹å³åˆ‡æ¢åˆ°æ‹–æ‹½åŠ¨ç”»ï¼ˆä¸‹æ’ï¼‰
            updateSheepFrame(sheepData);
            
            // å¢åŠ æŠ“ç¾Šè®¡æ•°
            catchCount++;
            updateCatchCounter();
            
            updateMainSheepData();
            updateStatus();
            
            console.log('å¼€å§‹æ‹–æ‹½å°ç¾Š:', sheepData.id, 'æ€»æŠ“ç¾Šæ¬¡æ•°:', catchCount);
        }

        function stopAutoWalkSheep(sheepData) {
            if (sheepData.autoWalkInterval) {
                clearInterval(sheepData.autoWalkInterval);
                sheepData.autoWalkInterval = null;
            }
            sheepData.isAutoWalking = false;
        }

        // è‡ªåŠ¨è¡Œèµ°æŒ‡å®šå°ç¾Š
        function startAutoWalkSheep(sheepData) {
            if (sheepData.autoWalkInterval) return;
            
            sheepData.isAutoWalking = true;
            sheepData.autoWalkInterval = setInterval(() => {
                const step = sheepData.walkSpeed; // åªå‘å³èµ°ï¼Œä¸éœ€è¦ä¹˜ä»¥direction
                
                // å‘å³ç§»åŠ¨
                sheepData.currentX += step;
                
                // æ£€æŸ¥å³è¾¹ç•Œï¼Œä»å·¦è¾¹å‡ºç°
                if (sheepData.currentX > window.innerWidth) {
                    sheepData.currentX = -frameWidth;
                }
                
                // æ›´æ–°ä½ç½®å’ŒåŠ¨ç”»
                sheepData.totalDistance += Math.abs(step);
                const frameStep = Math.floor(sheepData.totalDistance / frameDistance);
                sheepData.currentFrame = frameStep % 8;
                sheepData.isWalking = true;
                
                updateSheepPosition(sheepData);
                updateSheepFrame(sheepData);
            }, 30);
        }
    </script>
</body>
</html> 